<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RationSmart - Registration Flow</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="../shared.css">
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-brand"><i data-lucide="beef" class="icon"></i> RationSmart</div>
        <div class="sidebar-subtitle">User Flows &middot; 9 Pages</div>
        <h3>Authentication</h3>
        <a href="index.html"><span class="nav-num">00</span> Overview</a>
        <a href="registration.html" class="active"><span class="nav-num">01</span> Registration</a>
        <a href="login.html"><span class="nav-num">02</span> Login</a>
        <a href="forgot-pin.html"><span class="nav-num">03</span> Forgot PIN</a>
        <h3>Onboarding</h3>
        <a href="onboarding.html"><span class="nav-num">04</span> Onboarding (4 Steps)</a>
        <h3>Core App</h3>
        <a href="dashboard.html"><span class="nav-num">05</span> Home Dashboard</a>
        <a href="cow-management.html"><span class="nav-num">06</span> Cow Management</a>
        <a href="diet-wizard.html"><span class="nav-num">07</span> Diet Optimization</a>
        <a href="settings.html"><span class="nav-num">08</span> Settings</a>
    </nav>

    <main class="main">
        <div class="page-title">01 &mdash; Registration</div>
        <div class="page-route">Route: /auth/register</div>

        <p>New users create an account by providing their name, contact info (email or phone), and a 4-digit PIN. After successful registration the user is automatically logged in and redirected to the onboarding flow starting with language selection.</p>

        <!-- Flow Diagram -->
        <h2>Registration Flow</h2>
        <div style="overflow-x:auto; padding: 20px 0;">
            <div class="flow-box filled">START</div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box">Registration Page</div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box">Auto-Login</div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box filled">Onboarding (Language)</div>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- Wireframe 1 — Email Mode (default)                  -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Screen &mdash; Email Mode (Default)</h2>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="user-plus" class="icon" style="width:16px;height:16px;"></i> Register
            </div>
            <div class="phone-body">

                <!-- Branding -->
                <div class="ui-branding">
                    <div><i data-lucide="beef" class="icon" style="width:32px;height:32px;"></i></div>
                    <div class="name">RationSmart</div>
                    <div class="tag">Optimize your cattle nutrition</div>
                </div>

                <!-- Full Name -->
                <div class="ui-input">
                    <i data-lucide="user" class="icon"></i>
                    <span class="label">Full Name</span>
                </div>

                <!-- Email / Phone Toggle -->
                <div class="ui-toggle">
                    <span class="on">Email</span>
                    <span>Phone</span>
                </div>

                <!-- Email Input (active) -->
                <div class="ui-input">
                    <i data-lucide="mail" class="icon"></i>
                    <span class="label">Email Address</span>
                </div>

                <!-- Create PIN -->
                <div class="ui-input">
                    <i data-lucide="lock" class="icon"></i>
                    <span class="label">Create PIN</span>
                    <span class="value" style="flex:1;text-align:right;letter-spacing:4px;">****</span>
                    <i data-lucide="eye-off" class="icon"></i>
                </div>

                <!-- PIN Strength Indicator -->
                <div style="display:flex; align-items:center; gap:8px; margin:-6px 0 6px;">
                    <div style="flex:1; height:4px; background:var(--pass); border-radius:2px;"></div>
                    <div style="flex:1; height:4px; background:var(--pass); border-radius:2px;"></div>
                    <div style="flex:1; height:4px; background:var(--border-gray); border-radius:2px;"></div>
                    <span style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--pass);">Moderate</span>
                </div>

                <!-- Confirm PIN -->
                <div class="ui-input">
                    <i data-lucide="lock" class="icon"></i>
                    <span class="label">Confirm PIN</span>
                    <span class="value" style="flex:1;text-align:right;letter-spacing:4px;">****</span>
                    <i data-lucide="eye-off" class="icon"></i>
                </div>

                <!-- Register Button -->
                <div class="ui-btn">Create Account</div>

                <!-- Login Link -->
                <div class="ui-link">Already have an account? <strong>Login</strong></div>

            </div>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- Wireframe 2 — Phone Mode                            -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Screen &mdash; Phone Mode</h2>
        <p class="small muted mb-sm">When the user taps the Phone toggle, the email field is replaced with a country selector and phone number input.</p>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="user-plus" class="icon" style="width:16px;height:16px;"></i> Register
            </div>
            <div class="phone-body">

                <!-- Branding -->
                <div class="ui-branding">
                    <div><i data-lucide="beef" class="icon" style="width:32px;height:32px;"></i></div>
                    <div class="name">RationSmart</div>
                    <div class="tag">Optimize your cattle nutrition</div>
                </div>

                <!-- Full Name -->
                <div class="ui-input">
                    <i data-lucide="user" class="icon"></i>
                    <span class="label">Full Name</span>
                </div>

                <!-- Email / Phone Toggle (Phone active) -->
                <div class="ui-toggle">
                    <span>Email</span>
                    <span class="on">Phone</span>
                </div>

                <!-- Country Selector -->
                <div class="ui-input">
                    <i data-lucide="globe" class="icon"></i>
                    <span class="value" style="flex:1;">India (+91)</span>
                    <i data-lucide="chevron-down" class="icon"></i>
                </div>

                <!-- Phone Input with flag prefix -->
                <div class="ui-input">
                    <i data-lucide="phone" class="icon"></i>
                    <span class="value" style="font-weight:600;">+91</span>
                    <span class="label" style="flex:1;">##########</span>
                </div>

                <!-- Create PIN -->
                <div class="ui-input">
                    <i data-lucide="lock" class="icon"></i>
                    <span class="label">Create PIN</span>
                    <span class="value" style="flex:1;text-align:right;letter-spacing:4px;">****</span>
                    <i data-lucide="eye-off" class="icon"></i>
                </div>

                <!-- PIN Strength Indicator -->
                <div style="display:flex; align-items:center; gap:8px; margin:-6px 0 6px;">
                    <div style="flex:1; height:4px; background:var(--pass); border-radius:2px;"></div>
                    <div style="flex:1; height:4px; background:var(--pass); border-radius:2px;"></div>
                    <div style="flex:1; height:4px; background:var(--border-gray); border-radius:2px;"></div>
                    <span style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--pass);">Moderate</span>
                </div>

                <!-- Confirm PIN -->
                <div class="ui-input">
                    <i data-lucide="lock" class="icon"></i>
                    <span class="label">Confirm PIN</span>
                    <span class="value" style="flex:1;text-align:right;letter-spacing:4px;">****</span>
                    <i data-lucide="eye-off" class="icon"></i>
                </div>

                <!-- Register Button -->
                <div class="ui-btn">Create Account</div>

                <!-- Login Link -->
                <div class="ui-link">Already have an account? <strong>Login</strong></div>

            </div>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- Annotations                                         -->
        <!-- ──────────────────────────────────────────────────── -->

        <h2>Annotations</h2>

        <!-- Annotation 1 — Validation Rules -->
        <div class="annotation">
            <div class="annotation-title">Validation Rules</div>
            <ul>
                <li>Full Name is required (minimum 2 characters)</li>
                <li>Email must be valid format (<code>user@domain.com</code>)</li>
                <li>Phone digit count varies by country: India (10), Kenya (9), Ethiopia (9), Nepal (10), Bangladesh (11), Vietnam (9)</li>
                <li>PIN must be exactly 4 digits</li>
                <li>Confirm PIN must match Create PIN</li>
                <li>PIN strength indicator shows weak/moderate/strong as user types</li>
                <li>Country is required (defaults to India)</li>
            </ul>
            <div class="note">All fields are validated on blur and again on form submission. The Register button stays enabled but shows inline errors if validation fails.</div>
        </div>

        <!-- Annotation 2 — Country Selector -->
        <div class="annotation">
            <div class="annotation-title">Country Selector</div>
            <ul>
                <li>Fetches countries from API (<code>/api/v1/countries</code>)</li>
                <li>Falls back to 6 hardcoded countries if API fails: India, Kenya, Ethiopia, Nepal, Bangladesh, Vietnam</li>
                <li>Shows flag SVG icon + country name + dial code (e.g., "India (+91)")</li>
                <li>Backend returns alpha-3 codes (IND), frontend converts to alpha-2 (IN)</li>
                <li>Flag images are static SVGs at <code>/flags/{code}.svg</code></li>
            </ul>
            <div class="note">The country list is fetched once on component mount and cached for the session. Changing the country updates both the dial-code prefix and the phone input mask.</div>
        </div>

        <!-- Annotation 3 — After Registration -->
        <div class="annotation">
            <div class="annotation-title">After Registration</div>
            <ul>
                <li>Account created, tokens stored in localStorage (always "remembered" for new users going through onboarding)</li>
                <li>Auto-redirects to <code>/auth/language</code> (first onboarding step)</li>
                <li>User's self-farmer-profile is NOT created yet (happens at onboarding step 4)</li>
                <li><code>needsOnboarding</code> flag remains <code>true</code> until profile setup completes</li>
            </ul>
            <div class="note">If the user closes the app mid-onboarding, they will be redirected back to the onboarding flow on next login because needsOnboarding is still true.</div>
        </div>

        <!-- Annotation 4 — Phone Input Behavior -->
        <div class="annotation">
            <div class="annotation-title">Phone Input Behavior</div>
            <ul>
                <li>When user selects Phone toggle, shows country dropdown + phone input</li>
                <li>Phone input prefixed with flag icon + dial code (e.g., flag_IN + "+91")</li>
                <li>Input mask changes based on selected country</li>
                <li>Phone stored in E.164 format (e.g., <code>+919876543210</code>)</li>
            </ul>
            <div class="note">The phone input uses <code>type="tel"</code> to trigger numeric keyboards on mobile devices. Only digits are accepted; non-numeric characters are stripped on input.</div>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- Phone Masks Table                                   -->
        <!-- ──────────────────────────────────────────────────── -->

        <h2>Phone Masks by Country</h2>
        <table>
            <tr>
                <th>Country</th>
                <th>Code</th>
                <th>Dial Code</th>
                <th>Digits</th>
                <th>Mask</th>
            </tr>
            <tr>
                <td>India</td>
                <td><code>IN</code></td>
                <td><code>+91</code></td>
                <td>10</td>
                <td><code>##########</code></td>
            </tr>
            <tr>
                <td>Kenya</td>
                <td><code>KE</code></td>
                <td><code>+254</code></td>
                <td>9</td>
                <td><code>#########</code></td>
            </tr>
            <tr>
                <td>Ethiopia</td>
                <td><code>ET</code></td>
                <td><code>+251</code></td>
                <td>9</td>
                <td><code>#########</code></td>
            </tr>
            <tr>
                <td>Nepal</td>
                <td><code>NP</code></td>
                <td><code>+977</code></td>
                <td>10</td>
                <td><code>##########</code></td>
            </tr>
            <tr>
                <td>Bangladesh</td>
                <td><code>BD</code></td>
                <td><code>+880</code></td>
                <td>11</td>
                <td><code>###########</code></td>
            </tr>
            <tr>
                <td>Vietnam</td>
                <td><code>VN</code></td>
                <td><code>+84</code></td>
                <td>9</td>
                <td><code>#########</code></td>
            </tr>
        </table>

    </main>
    <script>lucide.createIcons();</script>
</body>
</html>
