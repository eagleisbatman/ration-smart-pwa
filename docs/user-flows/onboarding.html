<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RationSmart - Onboarding Flow</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="../shared.css">
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-brand"><i data-lucide="beef" class="icon"></i> RationSmart</div>
        <div class="sidebar-subtitle">User Flows &middot; 9 Pages</div>
        <h3>Authentication</h3>
        <a href="index.html"><span class="nav-num">00</span> Overview</a>
        <a href="registration.html"><span class="nav-num">01</span> Registration</a>
        <a href="login.html"><span class="nav-num">02</span> Login</a>
        <a href="forgot-pin.html"><span class="nav-num">03</span> Forgot PIN</a>
        <h3>Onboarding</h3>
        <a href="onboarding.html" class="active"><span class="nav-num">04</span> Onboarding (4 Steps)</a>
        <h3>Core App</h3>
        <a href="dashboard.html"><span class="nav-num">05</span> Home Dashboard</a>
        <a href="cow-management.html"><span class="nav-num">06</span> Cow Management</a>
        <a href="diet-wizard.html"><span class="nav-num">07</span> Diet Optimization</a>
        <a href="settings.html"><span class="nav-num">08</span> Settings</a>
    </nav>

    <main class="main">
        <div class="page-title">04 &mdash; Onboarding (4 Steps)</div>
        <div class="page-route">Routes: /auth/language &rarr; /auth/role &rarr; /auth/organization &rarr; /auth/profile-setup</div>

        <p>After registration, users complete a 4-step onboarding flow: choose a language, select their role, pick an organization (or skip), and set up their profile with GPS location. The onboarding flow must be completed before accessing the main app. All intermediate selections are persisted in localStorage with a 24-hour TTL so users can resume if interrupted.</p>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- Flow Diagram                                        -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Onboarding Flow</h2>
        <div style="overflow-x:auto; padding: 20px 0;">
            <div class="flow-group">
                <div class="flow-box">Language</div>
                <span class="flow-arrow">&rarr;</span>
                <div class="flow-box">Role</div>
                <span class="flow-arrow">&rarr;</span>
                <div class="flow-box">Organization</div>
                <span class="flow-arrow">&rarr;</span>
                <div class="flow-box">Profile</div>
            </div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box filled">Home Dashboard</div>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- STEP 1 — Language Selection                         -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Step 1: Language Selection</h2>
        <div class="section-label">/auth/language</div>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="globe" class="icon" style="width:16px;height:16px;"></i> Choose Your Language
                <span style="margin-left:auto;font-size:11px;font-weight:400;opacity:0.7;">Step 1 of 4</span>
            </div>
            <div class="phone-body">

                <!-- Language Grid -->
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:14px;">
                    <div class="ui-card selected" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">English</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Hindi</div>
                        <div style="font-size:11px; color:#999;">&#x0939;&#x093F;&#x0928;&#x094D;&#x0926;&#x0940;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Bengali</div>
                        <div style="font-size:11px; color:#999;">&#x09AC;&#x09BE;&#x0982;&#x09B2;&#x09BE;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Telugu</div>
                        <div style="font-size:11px; color:#999;">&#x0C24;&#x0C46;&#x0C32;&#x0C41;&#x0C17;&#x0C41;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Marathi</div>
                        <div style="font-size:11px; color:#999;">&#x092E;&#x0930;&#x093E;&#x0920;&#x0940;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Tamil</div>
                        <div style="font-size:11px; color:#999;">&#x0BA4;&#x0BAE;&#x0BBF;&#x0BB4;&#x0BCD;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Gujarati</div>
                        <div style="font-size:11px; color:#999;">&#x0A97;&#x0AC1;&#x0A9C;&#x0AB0;&#x0ABE;&#x0AA4;&#x0AC0;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Kannada</div>
                        <div style="font-size:11px; color:#999;">&#x0C95;&#x0CA8;&#x0CCD;&#x0CA8;&#x0CA1;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Malayalam</div>
                        <div style="font-size:11px; color:#999;">&#x0D2E;&#x0D32;&#x0D2F;&#x0D3E;&#x0D33;&#x0D02;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Odia</div>
                        <div style="font-size:11px; color:#999;">&#x0B13;&#x0B21;&#x0B3C;&#x0B3F;&#x0B06;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Punjabi</div>
                        <div style="font-size:11px; color:#999;">&#x0A2A;&#x0A70;&#x0A1C;&#x0A3E;&#x0A2C;&#x0A40;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Assamese</div>
                        <div style="font-size:11px; color:#999;">&#x0985;&#x09B8;&#x09AE;&#x09C0;&#x09AF;&#x09BC;&#x09BE;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Urdu</div>
                        <div style="font-size:11px; color:#999;">&#x0627;&#x0631;&#x062F;&#x0648;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Nepali</div>
                        <div style="font-size:11px; color:#999;">&#x0928;&#x0947;&#x092A;&#x093E;&#x0932;&#x0940;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Vietnamese</div>
                        <div style="font-size:11px; color:#999;">Ti&#x1EBF;ng Vi&#x1EC7;t</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Amharic</div>
                        <div style="font-size:11px; color:#999;">&#x12A0;&#x121B;&#x122D;&#x129B;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Oromo</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Indonesian</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Filipino</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Thai</div>
                        <div style="font-size:11px; color:#999;">&#x0E44;&#x0E17;&#x0E22;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">Arabic</div>
                        <div style="font-size:11px; color:#999;">&#x0627;&#x0644;&#x0639;&#x0631;&#x0628;&#x064A;&#x0629;</div>
                    </div>
                    <div class="ui-card" style="text-align:center; padding:10px 8px;">
                        <div style="font-weight:600; font-size:13px;">French</div>
                        <div style="font-size:11px; color:#999;">Fran&#231;ais</div>
                    </div>
                </div>

                <!-- Next Button -->
                <div class="ui-btn">Next <i data-lucide="arrow-right" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-left:4px;"></i></div>
            </div>
        </div>

        <!-- Annotation -->
        <div class="annotation">
            <div class="annotation-title">Language Selection Details</div>
            <ul>
                <li>22 languages supported across 10 regions</li>
                <li>No flag emoji used (breaks on Windows) &mdash; text labels only showing native script name</li>
                <li>Selection saved via onboarding-storage (localStorage with 24h TTL)</li>
                <li>UI language switches immediately on selection</li>
                <li>Languages grouped by region in the actual app UI</li>
            </ul>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- STEP 2 — Role Selection                             -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Step 2: Role Selection</h2>
        <div class="section-label">/auth/role</div>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="user-check" class="icon" style="width:16px;height:16px;"></i> What Best Describes You?
                <span style="margin-left:auto;font-size:11px;font-weight:400;opacity:0.7;">Step 2 of 4</span>
            </div>
            <div class="phone-body">

                <!-- Role Cards -->
                <div class="ui-card selected" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="wheat" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Farmer</div>
                        <div style="font-size:12px;color:#999;">I manage my own cattle</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="school" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Student</div>
                        <div style="font-size:12px;color:#999;">Learning animal nutrition</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="flask-conical" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Nutritionist</div>
                        <div style="font-size:12px;color:#999;">I advise farmers on nutrition</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="users" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Extension Worker</div>
                        <div style="font-size:12px;color:#999;">I support farmers in the field</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="microscope" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Researcher</div>
                        <div style="font-size:12px;color:#999;">I study animal nutrition</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="store" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Feed Supplier</div>
                        <div style="font-size:12px;color:#999;">I supply animal feed</div>
                    </div>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="more-horizontal" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Other</div>
                    </div>
                </div>

                <!-- Back / Next Buttons -->
                <div style="display:flex;gap:8px;margin-top:14px;">
                    <div class="ui-btn ui-btn-outline" style="flex:1;margin:0;"><i data-lucide="arrow-left" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-right:4px;"></i> Back</div>
                    <div class="ui-btn" style="flex:1;margin:0;">Next <i data-lucide="arrow-right" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-left:4px;"></i></div>
                </div>
            </div>
        </div>

        <!-- Annotation -->
        <div class="annotation">
            <div class="annotation-title">Role Selection Details</div>
            <ul>
                <li>7 role cards: Farmer, Student, Nutritionist, Extension Worker, Researcher, Feed Supplier, Other</li>
                <li>Role determines dashboard view and feature access</li>
                <li>Extension Worker &rarr; sees dual dashboard (My Farmers + Personal)</li>
                <li>Farmer &rarr; sees simple personal dashboard</li>
                <li>Role can be changed later in Settings</li>
                <li>Saved to onboarding-storage, sent to backend on profile creation</li>
                <li>Back navigation restores previously selected role from onboarding-storage</li>
            </ul>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- STEP 3 — Organization                               -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Step 3: Organization</h2>
        <div class="section-label">/auth/organization</div>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="building-2" class="icon" style="width:16px;height:16px;"></i> Are You Affiliated?
                <span style="margin-left:auto;font-size:11px;font-weight:400;opacity:0.7;">Step 3 of 4</span>
            </div>
            <div class="phone-body">

                <!-- Search Input -->
                <div class="ui-input">
                    <i data-lucide="search" class="icon"></i>
                    <span class="label">Search organizations...</span>
                </div>

                <!-- Not Affiliated Card -->
                <div class="ui-card selected" style="display:flex;align-items:center;gap:12px;">
                    <i data-lucide="user" class="icon" style="width:24px;height:24px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:14px;">Not Affiliated</div>
                        <div style="font-size:12px;color:#999;">I work independently</div>
                    </div>
                </div>

                <div class="section-label" style="margin:16px 0 8px;">Organizations</div>

                <!-- Organization List -->
                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">Digital Green</div>
                    </div>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 8px;border:1px solid #ddd;border-radius:4px;color:#666;text-transform:uppercase;">NGO</span>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">NDDB</div>
                    </div>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 8px;border:1px solid #ddd;border-radius:4px;color:#666;text-transform:uppercase;">Government</span>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">ILRI</div>
                    </div>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 8px;border:1px solid #ddd;border-radius:4px;color:#666;text-transform:uppercase;">Research</span>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">Amul Dairy Cooperative</div>
                    </div>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 8px;border:1px solid #ddd;border-radius:4px;color:#666;text-transform:uppercase;">Cooperative</span>
                </div>

                <div class="ui-card" style="display:flex;align-items:center;gap:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">TANUVAS</div>
                    </div>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:2px 8px;border:1px solid #ddd;border-radius:4px;color:#666;text-transform:uppercase;">University</span>
                </div>

                <!-- Back / Next Buttons -->
                <div style="display:flex;gap:8px;margin-top:14px;">
                    <div class="ui-btn ui-btn-outline" style="flex:1;margin:0;"><i data-lucide="arrow-left" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-right:4px;"></i> Back</div>
                    <div class="ui-btn" style="flex:1;margin:0;">Next <i data-lucide="arrow-right" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-left:4px;"></i></div>
                </div>
            </div>
        </div>

        <!-- Annotation -->
        <div class="annotation">
            <div class="annotation-title">Organization Details</div>
            <ul>
                <li>Organizations fetched from API: <code>GET /api/v1/organizations?country_id={id}</code></li>
                <li>Filtered by user's country (set during registration)</li>
                <li>"Not Affiliated" sends <code>null</code> organization_id</li>
                <li>Organization types: university, government, ngo, cooperative, research</li>
                <li>Search filters by name and type</li>
                <li>Back navigation restores previously selected org from onboarding-storage</li>
            </ul>
        </div>

        <!-- ──────────────────────────────────────────────────── -->
        <!-- STEP 4 — Profile Setup                              -->
        <!-- ──────────────────────────────────────────────────── -->
        <h2>Step 4: Profile Setup</h2>
        <div class="section-label">/auth/profile-setup</div>

        <div class="phone-frame">
            <div class="phone-header">
                <i data-lucide="user-cog" class="icon" style="width:16px;height:16px;"></i> Create Your Profile
                <span style="margin-left:auto;font-size:11px;font-weight:400;opacity:0.7;">Step 4 of 4</span>
            </div>
            <div class="phone-body">

                <!-- Full Name (pre-filled) -->
                <div class="ui-input">
                    <i data-lucide="user" class="icon"></i>
                    <span class="label">Full Name</span>
                    <span class="value" style="flex:1;text-align:right;">Ravi Kumar</span>
                </div>

                <!-- Phone Number (optional) -->
                <div class="ui-input">
                    <i data-lucide="phone" class="icon"></i>
                    <span class="value" style="font-weight:600;">+91</span>
                    <span class="label" style="flex:1;">Phone Number (optional)</span>
                </div>

                <!-- Location Section -->
                <div class="section-label">Location</div>

                <div class="ui-btn ui-btn-outline" style="display:flex;align-items:center;justify-content:center;gap:8px;">
                    <i data-lucide="map-pin" class="icon" style="width:16px;height:16px;"></i> Share My Location
                </div>

                <!-- GPS Result (shown after location captured) -->
                <div style="border:2px solid #ddd;border-radius:8px;padding:14px;margin-top:10px;background:#f5f5f5;">
                    <div style="font-family:'JetBrains Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:#999;margin-bottom:10px;">Location Captured</div>

                    <div class="ui-input" style="margin-bottom:8px;">
                        <i data-lucide="map" class="icon"></i>
                        <span class="label">Village</span>
                        <span class="value" style="flex:1;text-align:right;">Connaught Place</span>
                    </div>

                    <div class="ui-input" style="margin-bottom:8px;">
                        <i data-lucide="map" class="icon"></i>
                        <span class="label">District</span>
                        <span class="value" style="flex:1;text-align:right;">New Delhi</span>
                    </div>

                    <div class="ui-input" style="margin-bottom:8px;">
                        <i data-lucide="map" class="icon"></i>
                        <span class="label">State</span>
                        <span class="value" style="flex:1;text-align:right;">Delhi</span>
                    </div>

                    <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#999;text-align:center;">GPS: 28.6139, 77.2090</div>
                </div>

                <!-- GPS Failure Banner (alternative state) -->
                <div style="border:2px solid #f90;border-radius:8px;padding:12px;margin-top:12px;background:#fff8f0;display:flex;align-items:center;gap:10px;">
                    <i data-lucide="alert-triangle" class="icon" style="width:20px;height:20px;color:#f90;"></i>
                    <div style="flex:1;">
                        <div style="font-size:13px;font-weight:600;">Could not get location</div>
                        <div style="font-size:12px;color:#999;">Please enable GPS or enter manually</div>
                    </div>
                    <div style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;padding:6px 12px;border:2px solid #1a1a1a;border-radius:6px;cursor:pointer;">Retry</div>
                </div>

                <!-- Back / Done Buttons -->
                <div style="display:flex;gap:8px;margin-top:14px;">
                    <div class="ui-btn ui-btn-outline" style="flex:1;margin:0;"><i data-lucide="arrow-left" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-right:4px;"></i> Back</div>
                    <div class="ui-btn" style="flex:1;margin:0;"><i data-lucide="check" class="icon" style="width:14px;height:14px;vertical-align:middle;margin-right:4px;"></i> Done</div>
                </div>
            </div>
        </div>

        <!-- Annotation — Profile Setup -->
        <div class="annotation">
            <div class="annotation-title">Profile Setup Details</div>
            <ul>
                <li>Name pre-filled from registration data</li>
                <li>GPS uses browser Geolocation API</li>
                <li>Location fields displayed bottom-up: Village &rarr; District &rarr; State</li>
                <li>Backend supports 6 location levels: country, state, district, taluka, block, village &mdash; the form shows the 3 primary ones (village, district, state)</li>
                <li>If GPS succeeds: reverse geocodes and all available location levels are populated automatically</li>
                <li>If GPS fails: user enters location manually</li>
                <li>On "Done": creates self-farmer-profile via API</li>
                <li>Sets <code>selfFarmerProfileId</code> in auth store &rarr; <code>needsOnboarding</code> becomes <code>false</code></li>
                <li>Redirects to Home Dashboard (<code>/</code>)</li>
            </ul>
        </div>

        <!-- Annotation — Onboarding Storage -->
        <div class="annotation">
            <div class="annotation-title">Onboarding Storage</div>
            <ul>
                <li>All selections stored in localStorage via <code>onboarding-storage.ts</code></li>
                <li>24-hour TTL &mdash; data expires after 24 hours</li>
                <li>Keys: <code>onboarding_language</code>, <code>onboarding_role</code>, <code>onboarding_org_id</code></li>
                <li>Back navigation reads from storage to restore selections</li>
                <li>Storage cleared after successful profile creation</li>
            </ul>
        </div>

    </main>
    <script>lucide.createIcons();</script>
</body>
</html>
